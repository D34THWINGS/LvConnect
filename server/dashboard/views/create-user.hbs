<script type="text/javascript">
  function autoFillEmail(el) {
    if (el.value) {
      return;
    }

    const firstName = document.querySelector('#firstNameInput').value || '';
    const lastName = document.querySelector('#lastNameInput').value || '';

    if (firstName.length && lastName.length) {
      el.value = `${firstName.toLowerCase()}.${lastName.toLowerCase()}@link-value.fr`;
    }
  }
</script>

<div class="mdl-grid">
  <form class="mdl-cell mdl-cell--6-col mdl-cell--3-offset-desktop mdl-cell--1-offset-tablet mdl-card mdl-shadow--2dp"
        method="POST">
    <div class="mdl-card__title">
      <h2 class="mdl-card__title-text">
        {{#if editMode }}
          Edit Partner
        {{else  }}
          Create Partner
        {{/if }}
      </h2>
    </div>
    <div class="mdl-card__supporting-text mdl-grid">
      {{error.message}}

      <div
        class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
        <input class="mdl-textfield__input" type="text" id="firstNameInput" name="firstName"
               value="{{userData.firstName}}" required>
        <label class="mdl-textfield__label" for="firstNameInput">First Name</label>
      </div>

      <div
        class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
        <input class="mdl-textfield__input" type="text" id="lastNameInput" name="lastName" value="{{userData.lastName}}"
               required>
        <label class="mdl-textfield__label" for="lastNameInput">Last Name</label>
      </div>

      <div class="mdl-cell mdl-cell--12-col mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
        <input class="mdl-textfield__input" type="email" id="emailInput" name="email"
               value="{{userData.email}}" required onfocus="autoFillEmail(this)">
        <label class="mdl-textfield__label" for="emailInput">Email</label>
      </div>

      {{#unless editMode}}
        <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <input class="mdl-textfield__input" type="password" id="plainPasswordInput" name="plainPassword" pattern=".{6,}" required>
          <label class="mdl-textfield__label" for="plainPasswordInput">Password</label>
        </div>

        <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <input class="mdl-textfield__input" type="password" id="plainPasswordCheckInput" name="plainPasswordCheck" pattern=".{6,}" required>
          <label class="mdl-textfield__label" for="plainPasswordCheckInput">Repeat Password</label>
        </div>
      {{/unless}}

      {{#each validRoles as |role|}}
        <div class="mdl-cell mdl-cell--4-col">
          <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="role-checkbox-{{ role }}">
            <input type="checkbox" name="roles" value="{{ role }}" id="role-checkbox-{{ role }}"
                   class="mdl-checkbox__input"{{#ifIncludes @root.userData.roles role}} checked{{/ifIncludes}}>
            <span class="mdl-checkbox__label">{{ role }}</span>
          </label>
        </div>
      {{/each}}

      <div
        class="mdl-cell mdl-cell--12-col mdl-cell--8-col-tablet mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
        <textarea class="mdl-textfield__input" type="text" id="descriptionInput" rows="6" name="description"
                  maxlength="255">{{userData.description}}</textarea>
        <label class="mdl-textfield__label" for="descriptionInput">Description</label>
        <span class="mdl-textfield__error"></span>
      </div>

      {{#each validCities as |city|}}
        <div class="mdl-cell mdl-cell--4-col">
          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="city-radio-{{ city }}">
            <input type="radio" name="city" value="{{ city }}" id="city-radio-{{ city }}"
                   class="mdl-radio__button" {{#ifEquals @root.userData.city city}}checked{{/ifEquals}}>
            <span class="mdl-radio__label">{{ city }}</span>
          </label>
        </div>
      {{/each}}

      <input type="hidden" name="crumb" value="{{crumb}}">
    </div>

    <div class="mdl-card__actions mdl-card--border">
      <button class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect" type="submit">
        {{#if editMode}}
          Save
        {{else}}
          Create partner
        {{/if}}
      </button>
      {{#if editMode}}
        <a class="mdl-button mdl-button--danger mdl-js-button mdl-js-ripple-effect"
           href="/dashboard/users/{{userData._id}}/delete"
           onclick="return confirm('Are you sure you want to delete {{userData.firstName}} {{userData.lastName}} ?');">
          Delete
        </a>
      {{/if}}
    </div>
  </form>
</div>
